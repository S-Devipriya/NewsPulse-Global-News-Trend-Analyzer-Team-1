<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trending News - NewsPulse</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .trend-card {
            transition: transform 0.2s;
            border-left: 4px solid #007bff;
        }
        .trend-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .trend-badge {
            font-size: 0.8em;
            padding: 4px 8px;
        }
        .topic-pill {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            display: inline-block;
        }
        .keyword-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 15px;
            padding: 5px 12px;
            margin: 3px;
            display: inline-block;
            font-size: 0.9em;
        }
        .trending-now {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }
        .article-card {
            transition: all 0.3s ease;
        }
        .article-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/dashboard">
                <i class="fas fa-chart-line"></i> NewsPulse Trends
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-user"></i> {{ user }}
                </span>
                <a class="nav-link" href="/dashboard"><i class="fas fa-home"></i> Dashboard</a>
                <a class="nav-link active" href="/trends"><i class="fas fa-fire"></i> Trends</a>
                <a class="nav-link" href="/profile"><i class="fas fa-cog"></i> Profile</a>
                <a class="nav-link" href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card trending-now text-white">
                    <div class="card-body text-center">
                        <h1><i class="fas fa-fire me-2"></i>TRENDING NOW</h1>
                        <p class="mb-0">Real-time trending topics and articles</p>
                        <small>Last updated: {{ now.strftime('%Y-%m-%d %H:%M') if now else '' }}</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Trending Topics -->
            <div class="col-md-4">
                <div class="card trend-card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-hashtag me-2"></i>Trending Topics</h5>
                    </div>
                    <div class="card-body">
                        {% if trends_data.topics %}
                            {% for topic, words in trends_data.topics.items() %}
                                <div class="mb-3">
                                    <strong class="text-primary">{{ topic }}:</strong>
                                    <div class="mt-1">
                                        {% for word in words[:5] %}
                                            <span class="keyword-item">{{ word }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted">No trending topics detected yet.</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Top Keywords -->
                <div class="card trend-card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-key me-2"></i>Top Keywords</h5>
                    </div>
                    <div class="card-body">
                        {% if trends_data.keywords %}
                            {% for keyword, count in trends_data.keywords.items() %}
                                <span class="keyword-item">
                                    {{ keyword }} <span class="badge bg-primary">{{ count }}</span>
                                </span>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted">No keywords data available.</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Trend Categories -->
                {% if trends_data.trend_categories %}
                <div class="card trend-card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-tags me-2"></i>Trend Categories</h5>
                    </div>
                    <div class="card-body">
                        {% for category, items in trends_data.trend_categories.items() %}
                            <div class="mb-2">
                                <strong class="text-info">{{ category }}:</strong>
                                <div>
                                    {% for item in items[:3] %}
                                        <span class="badge bg-light text-dark trend-badge">
                                            {{ item.keyword }} ({{ item.count }})
                                        </span>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Trending Articles -->
            <div class="col-md-8">
                <div class="card trend-card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-newspaper me-2"></i>Trending Articles</h5>
                    </div>
                    <div class="card-body">
                        {% if trends_data.trending_articles %}
                            {% for article in trends_data.trending_articles %}
                                <div class="card mb-3 article-card">
                                    <div class="card-body">
                                        <div class="row">
                                            {% if article.imageurl %}
                                            <div class="col-md-3">
                                                <img src="{{ article.imageurl }}" alt="Article image" 
                                                     class="img-fluid rounded" style="max-height: 100px; object-fit: cover;">
                                            </div>
                                            {% endif %}
                                            <div class="col-md-{% if article.imageurl %}9{% else %}12{% endif %}">
                                                <h6 class="card-title">
                                                    {% if article.url %}
                                                        <a href="{{ article.url }}" target="_blank" class="text-decoration-none text-dark">
                                                            {{ article.title }}
                                                        </a>
                                                    {% else %}
                                                        {{ article.title }}
                                                    {% endif %}
                                                </h6>
                                                <p class="card-text text-muted small">
                                                    {% if article.description %}
                                                        {{ article.description[:150] }}{% if article.description|length > 150 %}...{% endif %}
                                                    {% else %}
                                                        No description available.
                                                    {% endif %}
                                                </p>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <small class="text-muted">
                                                        <i class="fas fa-source me-1"></i>{{ article.source if article.source else 'Unknown Source' }}
                                                        <i class="fas fa-clock ms-2 me-1"></i>
                                                        {{ article.publishedAt.strftime('%b %d, %H:%M') if article.publishedAt else 'Recent' }}
                                                    </small>
                                                    {% if article.keywords %}
                                                    <div>
                                                        {% for keyword in article.keywords.split(',')[:2] %}
                                                            <span class="badge bg-secondary trend-badge">{{ keyword.strip() }}</span>
                                                        {% endfor %}
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted">No trending articles found. News data might be updating.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto-refresh trends every 2 minutes
        setTimeout(() => {
            window.location.reload();
        }, 120000);

        // Add click tracking for articles
        document.querySelectorAll('.article-card').forEach(card => {
            card.addEventListener('click', function() {
                const link = this.querySelector('a');
                if (link) {
                    window.open(link.href, '_blank');
                }
            });
        });
    </script>
</body>
</html>